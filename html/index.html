<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social Media Ultimate Formatter</title>
    <style>
        :root {
            --primary: #0a66c2;
            --primary-hover: #004182;
            --bg: #f8f9fa;
            --surface: #ffffff;
            --text-main: #191919;
            --text-sub: #666666;
            --border: #e0e0e0;
            --accent: #eef3f8;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .app-container {
            background: var(--surface);
            width: 100%;
            max-width: 750px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            border: 1px solid var(--border);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* HEADER */
        .header {
            padding: 24px 32px;
            border-bottom: 1px solid var(--border);
            background: #fff;
        }

        .header h1 {
            margin: 0;
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header p {
            margin: 6px 0 0;
            font-size: 0.9rem;
            color: var(--text-sub);
        }

        /* TOOLBARS */
        .toolbar-group {
            padding: 12px 24px;
            background: #fff;
            border-bottom: 1px solid var(--border);
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
        }

        .label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #999;
            font-weight: 600;
            margin-right: 8px;
        }

        button {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 8px 14px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.2s;
            color: #444;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        button:hover {
            background: var(--accent);
            border-color: var(--primary);
            color: var(--primary);
            transform: translateY(-1px);
        }

        button:active {
            transform: translateY(0);
        }

        /* Special button styles */
        .btn-magic {
            background: linear-gradient(135deg, #fff 0%, #f0f7ff 100%);
            border-color: #cce4ff;
            color: var(--primary);
            font-weight: 600;
        }

        /* Styles for button previews */
        .preview-bold { font-weight: bold; }
        .preview-italic { font-style: italic; }
        .preview-under { text-decoration: underline; }
        .preview-script { font-family: "Brush Script MT", cursive; }

        /* EDITOR */
        .editor-wrapper {
            position: relative;
            background: #fafafa;
        }

        textarea {
            width: 100%;
            height: 320px;
            border: none;
            padding: 32px;
            font-size: 1.05rem;
            line-height: 1.6;
            outline: none;
            background: transparent;
            font-family: inherit;
            color: #333;
            box-sizing: border-box; /* Ensures padding doesn't affect width */

            /* SCROLL & WRAP UPDATES */
            resize: none;           /* Prevents manual resizing */
            white-space: pre-wrap;  /* Wraps text to next line */
            word-wrap: break-word;  /* Breaks long words if necessary */
            overflow-y: auto;       /* Vertical Scrollbar */
            overflow-x: hidden;     /* Hides horizontal scrollbar */
        }

        /* FOOTER */
        .footer {
            padding: 16px 32px;
            background: #fff;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stats {
            font-size: 0.85rem;
            color: var(--text-sub);
            display: flex;
            gap: 15px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 28px;
            border-radius: 30px;
            font-weight: 600;
            font-size: 1rem;
            box-shadow: 0 4px 12px rgba(10, 102, 194, 0.2);
            cursor: pointer;
        }

        .btn-primary:hover {
            background: var(--primary-hover);
            color: white;
            box-shadow: 0 6px 16px rgba(10, 102, 194, 0.3);
        }

        /* TOAST NOTIFICATION */
        .toast {
            position: fixed;
            bottom: 40px;
            left: 50%;
            transform: translate(-50%, 20px);
            background: #333;
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .toast.visible {
            opacity: 1;
            transform: translate(-50%, 0);
        }

        /* EMOJI PICKER MODAL */
        .emoji-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .emoji-modal.visible {
            display: flex;
        }
        .emoji-modal-content {
            background: white;
            border-radius: 12px;
            padding: 24px;
            max-width: 400px;
            width: 90%;
            max-height: 70vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        .emoji-modal-content h2 {
            margin: 0 0 16px 0;
            color: var(--primary);
            font-size: 1.2rem;
        }
        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
        }
        .emoji-btn {
            background: #f0f0f0;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 8px;
            cursor: pointer;
            font-size: 1.8rem;
            transition: all 0.2s;
        }
        .emoji-btn:hover {
            background: var(--accent);
            border-color: var(--primary);
            transform: scale(1.1);
        }
        .emoji-close-btn {
            float: right;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
            padding: 0;
        }
        .emoji-close-btn:hover {
            color: #000;
        }

        /* HELPER FOR MOBILE */
        @media (max-width: 600px) {
            .app-container { border-radius: 0; height: 100vh; max-width: 100%; border: none; }
            .toolbar-group { padding: 10px; gap: 5px; justify-content: center; }
            textarea { padding: 20px; font-size: 1rem; }
            .header h1 { font-size: 1.2rem; }
            .label { display: none; }
        }
    </style>
</head>
<body>

<div class="app-container">
    <div class="header">
        <h1>Social Media Formatter <span>âœ¨</span></h1>
        <p>Convert GenAI text into formatted, engaging Social Media posts.</p>
    </div>

    <div class="toolbar-group">
        <span class="label">Styles</span>
        <button onclick="applyMapping('boldSans')" title="Bold Sans"><span class="preview-bold">B</span></button>
        <button onclick="applyMapping('italicSans')" title="Italic Sans"><span class="preview-italic">I</span></button>
        <button onclick="applyMapping('boldSerif')" title="Bold Serif"><span style="font-weight: bold; font-family: serif;">Bğ¬</span></button>
        <button onclick="applyMapping('boldItalicSerif')" title="Bold Italic Serif"><span style="font-weight: bold; font-style: italic; font-family: serif;">Bğˆ</span></button>
        <button onclick="applyMapping('italicSerif')" title="Italic Serif"><span style="font-style: italic; font-family: serif;">Iğ¬</span></button>
        <button onclick="applyMapping('sans')" title="Sans">Sans</button>
        <button onclick="applyMapping('fraktur')" title="Fraktur">ğ”‰ğ”¯ğ”ğ”¨</button>
        <button onclick="applyMapping('script')" title="Script">ğ’®ğ’¸ğ“‡</button>
        <button onclick="applyMapping('circular')" title="Circular">ğ”¸ğ”¹â„‚</button>
        <button onclick="applyMapping('square')" title="Square">ğš‚ğš€</button>
        <button onclick="applyUnderline()" title="Underline"><span class="preview-under">U</span></button>
        <div style="width:1px; height:20px; background:#ddd; margin:0 5px;"></div>
        <button onclick="clearFormat()" title="Clear Styles">Clear</button>
    </div>

    <div class="toolbar-group" style="background: #fcfcfc;">
        <span class="label">Code</span>
        <button onclick="formatInlineCode()" title="Inline Code">{ } Inline</button>
        <button onclick="formatCodeBlock()" title="Code Block">{ } Block</button>
    </div>

    <div class="toolbar-group" style="background: #fcfcfc;">
        <span class="label">Magic</span>
        <button class="btn-magic" onclick="autoEmojify()" title="Add emojis to keywords">
            âœ¨ Auto-Emojify
        </button>
        <button onclick="showEmojiPicker()" title="Show popular emojis">â• More Emoji</button>
        <button onclick="insertChar('â€¢ ')" title="Bullet">â€¢</button>
        <button onclick="insertChar('âœ… ')" title="Check">âœ…</button>
        <button onclick="insertChar('ğŸ”¥ ')" title="Fire">ğŸ”¥</button>
        <button onclick="insertChar('ğŸš€ ')" title="Rocket">ğŸš€</button>
        <button onclick="insertChar('ğŸ‘‰ ')" title="Pointer">ğŸ‘‰</button>
        <button onclick="convertShortcodes()" title="Convert :code: to emoji">ğŸ”„ :code:</button>
    </div>

    <div class="editor-wrapper">
        <textarea id="editor" placeholder="Paste your text here...
        
1. Select text and click 'B' or 'I' for styles.
2. Click 'Auto-Emojify' to instantly add relevance.
3. Use :smile: shortcodes if you prefer."></textarea>
    </div>

    <div class="footer">
        <div class="stats">
            <span id="charCount">0 chars</span>
            <span id="wordCount">0 words</span>
        </div>
        <button class="btn-primary" onclick="copyText()">Copy for Social Media</button>
    </div>
</div>

<div id="toast" class="toast">Post copied to clipboard!</div>

<!-- EMOJI PICKER MODAL -->
<div id="emojiModal" class="emoji-modal">
    <div class="emoji-modal-content">
        <button class="emoji-close-btn" onclick="closeEmojiPicker()" type="button">âœ•</button>
        <h2>Popular Emojis</h2>
        <div class="emoji-grid">
            <button class="emoji-btn" onclick="insertEmoji('ğŸš€')" type="button">ğŸš€</button>
            <button class="emoji-btn" onclick="insertEmoji('ğŸ”¥')" type="button">ğŸ”¥</button>
            <button class="emoji-btn" onclick="insertEmoji('ğŸ’¡')" type="button">ğŸ’¡</button>
            <button class="emoji-btn" onclick="insertEmoji('ğŸ¯')" type="button">ğŸ¯</button>
            <button class="emoji-btn" onclick="insertEmoji('ğŸ“ˆ')" type="button">ğŸ“ˆ</button>
            <button class="emoji-btn" onclick="insertEmoji('ğŸ’°')" type="button">ğŸ’°</button>
            <button class="emoji-btn" onclick="insertEmoji('ğŸ¤')" type="button">ğŸ¤</button>
            <button class="emoji-btn" onclick="insertEmoji('âœ…')" type="button">âœ…</button>
            <button class="emoji-btn" onclick="insertEmoji('âš¡')" type="button">âš¡</button>
            <button class="emoji-btn" onclick="insertEmoji('ğŸ‘')" type="button">ğŸ‘</button>
            <button class="emoji-btn" onclick="insertEmoji('ğŸ’¯')" type="button">ğŸ’¯</button>
            <button class="emoji-btn" onclick="insertEmoji('ğŸŒŸ')" type="button">ğŸŒŸ</button>
            <button class="emoji-btn" onclick="insertEmoji('ğŸ˜Š')" type="button">ğŸ˜Š</button>
            <button class="emoji-btn" onclick="insertEmoji('ğŸ‰')" type="button">ğŸ‰</button>
            <button class="emoji-btn" onclick="insertEmoji('ğŸ“š')" type="button">ğŸ“š</button>
            <button class="emoji-btn" onclick="insertEmoji('ğŸ’»')" type="button">ğŸ’»</button>
            <button class="emoji-btn" onclick="insertEmoji('ğŸ› ï¸')" type="button">ğŸ› ï¸</button>
            <button class="emoji-btn" onclick="insertEmoji('â°')" type="button">â°</button>
            <button class="emoji-btn" onclick="insertEmoji('ğŸ“')" type="button">ğŸ“</button>
            <button class="emoji-btn" onclick="insertEmoji('ğŸ“§')" type="button">ğŸ“§</button>
        </div>
    </div>
</div>

<script>
    const editor = document.getElementById('editor');
    const charCount = document.getElementById('charCount');
    const wordCount = document.getElementById('wordCount');

    // --- 1. UNICODE MAPS FOR STYLING ---
    const maps = {
        boldSans: {
            a: 'ğ—®', b: 'ğ—¯', c: 'ğ—°', d: 'ğ—±', e: 'ğ—²', f: 'ğ—³', g: 'ğ—´', h: 'ğ—µ', i: 'ğ—¶', j: 'ğ—·', k: 'ğ—¸', l: 'ğ—¹', m: 'ğ—º', n: 'ğ—»', o: 'ğ—¼', p: 'ğ—½', q: 'ğ—¾', r: 'ğ—¿', s: 'ğ˜€', t: 'ğ˜', u: 'ğ˜‚', v: 'ğ˜ƒ', w: 'ğ˜„', x: 'ğ˜…', y: 'ğ˜†', z: 'ğ˜‡',
            A: 'ğ—”', B: 'ğ—•', C: 'ğ—–', D: 'ğ——', E: 'ğ—˜', F: 'ğ—™', G: 'ğ—š', H: 'ğ—›', I: 'ğ—œ', J: 'ğ—', K: 'ğ—', L: 'ğ—Ÿ', M: 'ğ— ', N: 'ğ—¡', O: 'ğ—¢', P: 'ğ—£', Q: 'ğ—¤', R: 'ğ—¥', S: 'ğ—¦', T: 'ğ—§', U: 'ğ—¨', V: 'ğ—©', W: 'ğ—ª', X: 'ğ—«', Y: 'ğ—¬', Z: 'ğ—­',
            0: 'ğŸ¬', 1: 'ğŸ­', 2: 'ğŸ®', 3: 'ğŸ¯', 4: 'ğŸ°', 5: 'ğŸ±', 6: 'ğŸ²', 7: 'ğŸ³', 8: 'ğŸ´', 9: 'ğŸµ'
        },
        italicSans: {
            a: 'ğ˜¢', b: 'ğ˜£', c: 'ğ˜¤', d: 'ğ˜¥', e: 'ğ˜¦', f: 'ğ˜§', g: 'ğ˜¨', h: 'ğ˜©', i: 'ğ˜ª', j: 'ğ˜«', k: 'ğ˜¬', l: 'ğ˜­', m: 'ğ˜®', n: 'ğ˜¯', o: 'ğ˜°', p: 'ğ˜±', q: 'ğ˜²', r: 'ğ˜³', s: 'ğ˜´', t: 'ğ˜µ', u: 'ğ˜¶', v: 'ğ˜·', w: 'ğ˜¸', x: 'ğ˜¹', y: 'ğ˜º', z: 'ğ˜»',
            A: 'ğ˜ˆ', B: 'ğ˜‰', C: 'ğ˜Š', D: 'ğ˜‹', E: 'ğ˜Œ', F: 'ğ˜', G: 'ğ˜', H: 'ğ˜', I: 'ğ˜', J: 'ğ˜‘', K: 'ğ˜’', L: 'ğ˜“', M: 'ğ˜”', N: 'ğ˜•', O: 'ğ˜–', P: 'ğ˜—', Q: 'ğ˜˜', R: 'ğ˜™', S: 'ğ˜š', T: 'ğ˜›', U: 'ğ˜œ', V: 'ğ˜', W: 'ğ˜', X: 'ğ˜Ÿ', Y: 'ğ˜ ', Z: 'ğ˜¡'
        },
        boldItalicSans: {
            a: 'ğ™–', b: 'ğ™—', c: 'ğ™˜', d: 'ğ™™', e: 'ğ™š', f: 'ğ™›', g: 'ğ™œ', h: 'ğ™', i: 'ğ™', j: 'ğ™Ÿ', k: 'ğ™ ', l: 'ğ™¡', m: 'ğ™¢', n: 'ğ™£', o: 'ğ™¤', p: 'ğ™¥', q: 'ğ™¦', r: 'ğ™§', s: 'ğ™¨', t: 'ğ™©', u: 'ğ™ª', v: 'ğ™«', w: 'ğ™¬', x: 'ğ™­', y: 'ğ™®', z: 'ğ™¯',
            A: 'ğ˜¼', B: 'ğ˜½', C: 'ğ˜¾', D: 'ğ˜¿', E: 'ğ™€', F: 'ğ™', G: 'ğ™‚', H: 'ğ™ƒ', I: 'ğ™„', J: 'ğ™…', K: 'ğ™†', L: 'ğ™‡', M: 'ğ™ˆ', N: 'ğ™‰', O: 'ğ™Š', P: 'ğ™‹', Q: 'ğ™Œ', R: 'ğ™', S: 'ğ™', T: 'ğ™', U: 'ğ™', V: 'ğ™‘', W: 'ğ™’', X: 'ğ™“', Y: 'ğ™”', Z: 'ğ™•',
            0: 'ğŸ¬', 1: 'ğŸ­', 2: 'ğŸ®', 3: 'ğŸ¯', 4: 'ğŸ°', 5: 'ğŸ±', 6: 'ğŸ²', 7: 'ğŸ³', 8: 'ğŸ´', 9: 'ğŸµ'
        },
        boldSerif: {
            a: 'ğš', b: 'ğ›', c: 'ğœ', d: 'ğ', e: 'ğ', f: 'ğŸ', g: 'ğ ', h: 'ğ¡', i: 'ğ¢', j: 'ğ£', k: 'ğ¤', l: 'ğ¥', m: 'ğ¦', n: 'ğ§', o: 'ğ¨', p: 'ğ©', q: 'ğª', r: 'ğ«', s: 'ğ¬', t: 'ğ­', u: 'ğ®', v: 'ğ¯', w: 'ğ°', x: 'ğ±', y: 'ğ²', z: 'ğ³',
            A: 'ğ€', B: 'ğ', C: 'ğ‚', D: 'ğƒ', E: 'ğ„', F: 'ğ…', G: 'ğ†', H: 'ğ‡', I: 'ğˆ', J: 'ğ‰', K: 'ğŠ', L: 'ğ‹', M: 'ğŒ', N: 'ğ', O: 'ğ', P: 'ğ', Q: 'ğ', R: 'ğ‘', S: 'ğ’', T: 'ğ“', U: 'ğ”', V: 'ğ•', W: 'ğ–', X: 'ğ—', Y: 'ğ˜', Z: 'ğ™'
        },
        boldItalicSerif: {
            a: 'ğ’‚', b: 'ğ’ƒ', c: 'ğ’„', d: 'ğ’…', e: 'ğ’†', f: 'ğ’‡', g: 'ğ’ˆ', h: 'ğ’‰', i: 'ğ’Š', j: 'ğ’‹', k: 'ğ’Œ', l: 'ğ’', m: 'ğ’', n: 'ğ’', o: 'ğ’', p: 'ğ’‘', q: 'ğ’’', r: 'ğ’“', s: 'ğ’”', t: 'ğ’•', u: 'ğ’–', v: 'ğ’—', w: 'ğ’˜', x: 'ğ’™', y: 'ğ’š', z: 'ğ’›',
            A: 'ğ‘¨', B: 'ğ‘©', C: 'ğ‘ª', D: 'ğ‘«', E: 'ğ‘¬', F: 'ğ‘­', G: 'ğ‘®', H: 'ğ‘¯', I: 'ğ‘°', J: 'ğ‘±', K: 'ğ‘²', L: 'ğ‘³', M: 'ğ‘´', N: 'ğ‘µ', O: 'ğ‘¶', P: 'ğ‘·', Q: 'ğ‘¸', R: 'ğ‘¹', S: 'ğ‘º', T: 'ğ‘»', U: 'ğ‘¼', V: 'ğ‘½', W: 'ğ‘¾', X: 'ğ‘¿', Y: 'ğ’€', Z: 'ğ’'
        },
        italicSerif: {
            a: 'ğ˜¢', b: 'ğ˜£', c: 'ğ˜¤', d: 'ğ˜¥', e: 'ğ˜¦', f: 'ğ˜§', g: 'ğ˜¨', h: 'ğ˜©', i: 'ğ˜ª', j: 'ğ˜«', k: 'ğ˜¬', l: 'ğ˜­', m: 'ğ˜®', n: 'ğ˜¯', o: 'ğ˜°', p: 'ğ˜±', q: 'ğ˜²', r: 'ğ˜³', s: 'ğ˜´', t: 'ğ˜µ', u: 'ğ˜¶', v: 'ğ˜·', w: 'ğ˜¸', x: 'ğ˜¹', y: 'ğ˜º', z: 'ğ˜»',
            A: 'ğ˜ˆ', B: 'ğ˜‰', C: 'ğ˜Š', D: 'ğ˜‹', E: 'ğ˜Œ', F: 'ğ˜', G: 'ğ˜', H: 'ğ˜', I: 'ğ˜', J: 'ğ˜‘', K: 'ğ˜’', L: 'ğ˜“', M: 'ğ˜”', N: 'ğ˜•', O: 'ğ˜–', P: 'ğ˜—', Q: 'ğ˜˜', R: 'ğ˜™', S: 'ğ˜š', T: 'ğ˜›', U: 'ğ˜œ', V: 'ğ˜', W: 'ğ˜', X: 'ğ˜Ÿ', Y: 'ğ˜ ', Z: 'ğ˜¡'
        },
        fraktur: {
            a: 'ğ”', b: 'ğ”Ÿ', c: 'ğ” ', d: 'ğ”¡', e: 'ğ”¢', f: 'ğ”£', g: 'ğ”¤', h: 'ğ”¥', i: 'ğ”¦', j: 'ğ”§', k: 'ğ”¨', l: 'ğ”©', m: 'ğ”ª', n: 'ğ”«', o: 'ğ”¬', p: 'ğ”­', q: 'ğ”®', r: 'ğ”¯', s: 'ğ”°', t: 'ğ”±', u: 'ğ”²', v: 'ğ”³', w: 'ğ”´', x: 'ğ”µ', y: 'ğ”¶', z: 'ğ”·',
            A: 'ğ”„', B: 'ğ”…', C: 'ğ”†', D: 'ğ”‡', E: 'ğ”ˆ', F: 'ğ”‰', G: 'ğ”Š', H: 'ğ”‹', I: 'ğ”Œ', J: 'ğ”', K: 'ğ”', L: 'ğ”', M: 'ğ”', N: 'ğ”‘', O: 'ğ”’', P: 'ğ”“', Q: 'ğ””', R: 'ğ”–', S: 'ğ”–', T: 'ğ”—', U: 'ğ”˜', V: 'ğ”™', W: 'ğ”š', X: 'ğ”›', Y: 'ğ”œ', Z: 'ğ”·'
        },
        script: {
            a: 'ğ’¶', b: 'ğ’·', c: 'ğ’¸', d: 'ğ’¹', e: 'ğ‘’', f: 'ğ’»', g: 'ğ‘”', h: 'ğ’½', i: 'ğ’¾', j: 'ğ’¿', k: 'ğ“€', l: 'ğ“', m: 'ğ“‚', n: 'ğ“ƒ', o: 'ğ‘œ', p: 'ğ“…', q: 'ğ“†', r: 'ğ“‡', s: 'ğ“ˆ', t: 'ğ“‰', u: 'ğ“Š', v: 'ğ“‹', w: 'ğ“Œ', x: 'ğ“', y: 'ğ“', z: 'ğ“',
            A: 'ğ’œ', B: 'ğµ', C: 'ğ’', D: 'ğ’Ÿ', E: 'ğ¸', F: 'ğ¹', G: 'ğ’¢', H: 'ğ»', I: 'ğ¼', J: 'ğ’¥', K: 'ğ’¦', L: 'ğ“', M: 'ğ‘€', N: 'ğ’©', O: 'ğ’ª', P: 'ğ’«', Q: 'ğ’¬', R: 'ğ‘…', S: 'ğ’®', T: 'ğ’¯', U: 'ğ’°', V: 'ğ’±', W: 'ğ’²', X: 'ğ’³', Y: 'ğ’´', Z: 'ğ’µ'
        },
        circular: {
            a: 'ğ•’', b: 'ğ•“', c: 'ğ•”', d: 'ğ••', e: 'ğ•–', f: 'ğ•—', g: 'ğ•˜', h: 'ğ•™', i: 'ğ•š', j: 'ğ•›', k: 'ğ•œ', l: 'ğ•', m: 'ğ•', n: 'ğ•Ÿ', o: 'ğ• ', p: 'ğ•¡', q: 'ğ•¢', r: 'ğ•£', s: 'ğ•¤', t: 'ğ•¥', u: 'ğ•¦', v: 'ğ•§', w: 'ğ•¨', x: 'ğ•©', y: 'ğ•ª', z: 'ğ•«',
            A: 'ğ”¸', B: 'ğ”¹', C: 'ğ•®', D: 'ğ”»', E: 'ğ”¼', F: 'ğ”½', G: 'ğ”¾', H: 'ğ•³', I: 'ğ•´', J: 'ğ•µ', K: 'ğ•¶', L: 'ğ•·', M: 'ğ•¸', N: 'ğ•¹', O: 'ğ•º', P: 'ğ•»', Q: 'ğ•¼', R: 'ğ•½', S: 'ğ•¾', T: 'ğ•¿', U: 'ğ–€', V: 'ğ–', W: 'ğ–‚', X: 'ğ–ƒ', Y: 'ğ–„', Z: 'ğ–…'
        },
        square: {
            a: 'ğšŠ', b: 'ğš‹', c: 'ğšŒ', d: 'ğš', e: 'ğš', f: 'ğš', g: 'ğš', h: 'ğš‘', i: 'ğš’', j: 'ğš“', k: 'ğš”', l: 'ğš•', m: 'ğš–', n: 'ğš—', o: 'ğš˜', p: 'ğš™', q: 'ğšš', r: 'ğš›', s: 'ğšœ', t: 'ğš', u: 'ğš', v: 'ğšŸ', w: 'ğš ', x: 'ğš¡', y: 'ğš¢', z: 'ğš£',
            A: 'ğ™°', B: 'ğ™±', C: 'ğ™²', D: 'ğ™³', E: 'ğ™´', F: 'ğ™µ', G: 'ğ™¶', H: 'ğ™·', I: 'ğ™¸', J: 'ğ™¹', K: 'ğ™º', L: 'ğ™»', M: 'ğ™¼', N: 'ğ™½', O: 'ğ™¾', P: 'ğ™¿', Q: 'ğš€', R: 'ğš', S: 'ğš‚', T: 'ğšƒ', U: 'ğš„', V: 'ğš…', W: 'ğš†', X: 'ğš‡', Y: 'ğšˆ', Z: 'ğš‰',
            0: 'ğŸ¶', 1: 'ğŸ·', 2: 'ğŸ¸', 3: 'ğŸ¹', 4: 'ğŸº', 5: 'ğŸ»', 6: 'ğŸ¼', 7: 'ğŸ½', 8: 'ğŸ¾', 9: 'ğŸ¿'
        },
        sans: {
            a: 'a', b: 'b', c: 'c', d: 'd', e: 'e', f: 'f', g: 'g', h: 'h', i: 'i', j: 'j', k: 'k', l: 'l', m: 'm', n: 'n', o: 'o', p: 'p', q: 'q', r: 'r', s: 's', t: 't', u: 'u', v: 'v', w: 'w', x: 'x', y: 'y', z: 'z',
            A: 'A', B: 'B', C: 'C', D: 'D', E: 'E', F: 'F', G: 'G', H: 'H', I: 'I', J: 'J', K: 'K', L: 'L', M: 'M', N: 'N', O: 'O', P: 'P', Q: 'Q', R: 'R', S: 'S', T: 'T', U: 'U', V: 'V', W: 'W', X: 'X', Y: 'Y', Z: 'Z'
        }
    };

    // Create reverse maps to detect existing formats (check in order of specificity)
    function createReverseMaps() {
        const reverse = {};
        // Check bold-italic first, then bold, then italic, then script, then others
        const order = ['boldItalicSans', 'boldItalicSerif', 'boldSans', 'boldSerif', 'italicSans', 'italicSerif', 'script', 'fraktur', 'circular', 'square', 'sans'];
        for (let type of order) {
            if (!maps[type]) continue;
            reverse[type] = {};
            for (let char in maps[type]) {
                reverse[type][maps[type][char]] = char;
            }
        }
        return reverse;
    }
    const reverseMaps = createReverseMaps();

    const buzzwordEmojiMap = {
        "growth": "ğŸ“ˆ", "sales": "ğŸ’°", "money": "ğŸ’µ", "profit": "ğŸ’¸", "team": "ğŸ¤", "developer": "ğŸ‘¨â€ğŸ’»", "engineer": "ğŸ› ï¸", "cloud": "â˜ï¸",
        "hiring": "ğŸ“¢", "jobs": "ğŸ’¼", "work": "ğŸ› ï¸", "code": "ğŸ’»", "tech": "ğŸ¤–",  
        "ai": "ğŸ§ ", "data": "ğŸ“Š", "idea": "ğŸ’¡", "goal": "ğŸ¯", "success": "ğŸ†",
        "win": "ğŸ…", "learn": "ğŸ“š", "time": "â³", "deadline": "â°", "launch": "ğŸš€",
        "fire": "ğŸ”¥", "hot": "ğŸ”¥", "happy": "ğŸ˜Š", "sad": "ğŸ˜”", "question": "â“",
        "email": "ğŸ“§", "call": "ğŸ“", "contact": "ğŸ“¬", "link": "ğŸ”—", "website": "ğŸŒ",
        "social_media": "ğŸŒ", "important": "âš ï¸", "alert": "ğŸš¨", "check": "âœ…", "done": "âœ…"
    };

    const shortcodeMap = {
        ":rocket:": "ğŸš€", ":fire:": "ğŸ”¥", ":check:": "âœ…", ":smile:": "ğŸ˜Š", 
        ":chart:": "ğŸ“ˆ", ":target:": "ğŸ¯", ":brain:": "ğŸ§ ", ":100:": "ğŸ’¯"
    };

    function getSelection() {
        const start = editor.selectionStart;
        const end = editor.selectionEnd;
        return { start, end, text: editor.value.substring(start, end) };
    }

    // Detect which formats are applied to a character
    function detectFormats(char) {
        if (reverseMaps.boldItalicSans && reverseMaps.boldItalicSans[char]) {
            return new Set(['boldSans', 'italicSans']); // Has both bold and italic
        }
        if (reverseMaps.boldSans && reverseMaps.boldSans[char]) {
            return new Set(['boldSans']);
        }
        if (reverseMaps.italicSans && reverseMaps.italicSans[char]) {
            return new Set(['italicSans']);
        }
        if (reverseMaps.script && reverseMaps.script[char]) {
            return new Set(['script']);
        }
        return new Set(); // Plain text
    }

    // Convert character to plain text
    function toPlain(char) {
        if (reverseMaps.boldItalicSans && reverseMaps.boldItalicSans[char]) {
            return reverseMaps.boldItalicSans[char];
        }
        if (reverseMaps.boldSans && reverseMaps.boldSans[char]) {
            return reverseMaps.boldSans[char];
        }
        if (reverseMaps.italicSans && reverseMaps.italicSans[char]) {
            return reverseMaps.italicSans[char];
        }
        if (reverseMaps.script && reverseMaps.script[char]) {
            return reverseMaps.script[char];
        }
        return char;
    }

    // Apply formatting with toggle and composition
    function applyMapping(type) {
        const sel = getSelection();
        if (!sel.text) return;

        let res = '';
        let allHaveSameState = true;
        let firstCharState = null;

        // Analyze first character's format state for consistency check
        if (sel.text.length > 0) {
            const firstFormats = detectFormats(sel.text[0]);
            firstCharState = formatSetToString(firstFormats);

            // Check if all characters have the same format state
            for (let i = 1; i < sel.text.length; i++) {
                const charFormats = detectFormats(sel.text[i]);
                if (formatSetToString(charFormats) !== firstCharState) {
                    allHaveSameState = false;
                    break;
                }
            }
        }

        // Process each character
        for (let char of sel.text) {
            const plainChar = toPlain(char);
            const currentFormats = detectFormats(char);

            // Determine new format set
            let newFormats = new Set(currentFormats);

            if (allHaveSameState && currentFormats.has(type)) {
                // Toggle OFF: User is turning off a format they already have
                newFormats.delete(type);
            } else {
                // Add the format
                newFormats.add(type);
            }

            // Convert to appropriate character
            let result = plainChar;
            
            if (newFormats.has('boldSans') && newFormats.has('italicSans')) {
                // Apply bold+italic combination
                result = maps.boldItalicSans[result] || result;
            } else if (newFormats.has('boldSans')) {
                // Apply only bold
                result = maps.boldSans[result] || result;
            } else if (newFormats.has('italicSans')) {
                // Apply only italic
                result = maps.italicSans[result] || result;
            } else if (newFormats.has('script')) {
                // Apply script
                result = maps.script[result] || result;
            }

            res += result;
        }

        replaceSelection(res);
    }

    // Helper to convert format set to string for comparison
    function formatSetToString(set) {
        const arr = Array.from(set).sort();
        return arr.join(',');
    }

    // Apply Underline (Using Combining Low Line \u0332)
    function applyUnderline() {
        const sel = getSelection();
        if (!sel.text) return;

        // Logic: Add \u0332 after every character
        let res = '';
        for (let char of sel.text) res += char + '\u0332';
        replaceSelection(res);
    }

    // --- 3. MAGIC EMOJI LOGIC ---

    // Option A: Auto-Emojify (Scans words and appends emojis)
    function autoEmojify() {
        const text = editor.value;
        const newText = text.replace(/\b(\w+)\b/g, (match) => {
            const lower = match.toLowerCase();
            if (buzzwordEmojiMap[lower]) return `${match} ${buzzwordEmojiMap[lower]}`;
            return match;
        });
        editor.value = newText;
        updateStats();
        showToast("Magic emojis applied! âœ¨");
    }

    function formatCodeBlock() {
        const sel = getSelection();
        if (!sel.text) return;

        const formatted = "```\n" + sel.text + "\n```";
        replaceSelection(formatted);
        showToast("Code block formatted! ğŸ’»");
    }

    function formatInlineCode() {
        const sel = getSelection();
        if (!sel.text) return;

        const formatted = "`" + sel.text + "`";
        replaceSelection(formatted);
        showToast("Inline code formatted! ğŸ“");
    }

    function showEmojiPicker() {
        const modal = document.getElementById('emojiModal');
        if (modal) modal.classList.add('visible');
    }

    function closeEmojiPicker() {
        const modal = document.getElementById('emojiModal');
        if (modal) modal.classList.remove('visible');
    }

    function insertEmoji(emoji) {
        const start = editor.selectionStart;
        editor.value = editor.value.substring(0, start) + emoji + ' ' + editor.value.substring(start);
        editor.selectionStart = editor.selectionEnd = start + emoji.length + 1;
        editor.focus();
        closeEmojiPicker();
        updateStats();
    }

    function convertShortcodes() {
        let text = editor.value;
        for (let code in shortcodeMap) {
            text = text.split(code).join(shortcodeMap[code]);
        }
        editor.value = text;
        updateStats();
    }

    // --- UTILS ---

    function insertChar(char) {
        const start = editor.selectionStart;
        const end = editor.selectionEnd;
        editor.value = editor.value.substring(0, start) + char + editor.value.substring(end);
        editor.selectionStart = editor.selectionEnd = start + char.length;
        editor.focus();
        updateStats();
    }

    function replaceSelection(newText) {
        const start = editor.selectionStart;
        editor.value = editor.value.substring(0, start) + newText + editor.value.substring(editor.selectionEnd);
        editor.selectionStart = editor.selectionEnd = start + newText.length;
        editor.focus();
        updateStats();
    }

    function clearFormat() {
        // Simple normalizer to remove non-ASCII (strips styling)
        const sel = getSelection();
        if (!sel.text) return;

        // Normalize string to NFD form and remove combining diacritics (fixes underline)
        let clean = sel.text.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        
        // Remove Math Bold/Italic by converting to ASCII range (rough approximation)
        // For a perfect clear, we would reverse map, but this clears "Underline" perfectly.
        // For this demo, let's just re-write the text as is if normalization fails, 
        // or mapping to plain text manually if needed.
        // Since we are replacing, let's just remove the combining chars for Underline mostly.
        
        replaceSelection(clean);
    }

    function copyText() {
        if(!editor.value) return;
        navigator.clipboard.writeText(editor.value).then(() => {
            showToast("Copied to clipboard! ğŸ“‹");
        });
    }

    function showToast(msg) {
        const toast = document.getElementById('toast');
        toast.textContent = msg;
        toast.classList.add('visible');
        setTimeout(() => toast.classList.remove('visible'), 2500);
    }

    function updateStats() {
        charCount.innerText = editor.value.length + " chars";
        wordCount.innerText = editor.value.trim().split(/\s+/).filter(n => n).length + " words";
    }

    editor.addEventListener('input', updateStats);

    // Close emoji modal when clicking outside
    document.getElementById('emojiModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeEmojiPicker();
        }
    });
</script>

</body>
</html>
